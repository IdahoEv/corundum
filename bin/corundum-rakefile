# vi: set ft=ruby:
require 'optparse'
require 'corundum/configuration-store'

options = {
  :write => false
}
OptionParser.new do |opti|
  opti.banner = "Usage: #{$0} [options]"

  opti.on "-w", "--write", "Actually write Rakefile" do |v|
    options[:write] = v
  end
end.parse!(ARGV)

if options[:write]
  require 'rake/application'
  if found = Rake::Application::DEFAULT_RAKEFILES.find{|path| File::exists?(path)}
    puts "Refusing to clobber existing '#{found}' - consider using >> to append"
    exit 1
  else
    File::open("Rakefile", "w") do |file|
      file.write(Corundum.configuration_store.loaded["example-rakefile"])
    end
    puts "Created Rakefile"
  end
else
  puts Corundum.configuration_store.loaded["example-rakefile"]
end
